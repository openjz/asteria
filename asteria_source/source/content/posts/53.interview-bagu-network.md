---
title: "面试八股-网络"
date: 2022-10-25T15:46:32+08:00
draft: false

tags: ["面试", "网络"]
categories: ["编程"]
---

## 网络模型

- OSI七层模型：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层；
- 简化的5层模型：应用层、传输层、网络层、数据链路层、物理层；
- TCP/IP的四层模型：应用层、传输层（TCP/UDP）、IP层、网络接口层；

## 传输层

### 常见端口号

http：80端口  
https：443端口

### TCP如何保证可靠传输

- 滑动窗口（序列号）、超时重传、选择确认（SACK）
  - 以字节为单位的滑动窗口
    - 每个字节对应一个编号；（为了能重传和能判断字节序）
    - 发送窗口和接收窗口
      - 发送窗口中是允许发送的字节，发送窗口前部是已发送并得到确认的字节，发送窗口后部是不允许发送的字节；
      - 接收窗口中是允许接收的字节，接收窗口前部是已经收到并确认过的字节，接收窗口后部是不允许接收的字节；
      - 发送窗口是发送方的发送缓存的一部分；接收窗口是接收方的接收缓存的一部分；
    - 发送方和接收方
      - B会将自己的接收窗口大小发送给A，因此发送窗口一定不会大于接收窗口；
      - **发送方发送的数据需要得到接收方的确认**，如果发送方发送结束后迟迟没有收到确认，则会触发**超时重传**，直到收到确认为止；
      - 每一方都有自己的发送窗口和接收窗口；因此A的发送窗口和B的接收窗口是一对，反之是另外一对，**序号各是各的**；
    - **选择超时重传时间**
      - TCP记录了一个加权平均往返时间RTT<sub>S</sub>，其中RTT是报文往返时间；再加上RTT偏差的加权平均值RTT<sub>D</sub>，最终得出了一个RTO，RTO就是超时重传时间。（并且，只要报文发生了重传，发送方就不将其计入RTT<sub>S</sub>的计算，因为发送方无法辨认接收方发来的确认是对第一次发的报文的确认还是重传的报文的确认，如果判断错了，这会导致RTT偏大）。
    - 选择确认（SACK）
      - 场景：接收方收到了一些数据，但另一些数据没有收到（或未按序到达），接收方希望发送方有选择地重传，而不是重传整个窗口的数据。
      - 建立TCP连接时，在TCP首部加上"允许SACK"的选项，然后在TCP报文中加入需要重传的字节段的边界序号；

### TCP流量控制

- 流量控制是指让客户端发送不要太快，让接收方来得及接收；
- 利用滑动窗口控制流量；当接收方感觉发送速率过快时，减小窗口值，并将窗口值发送给发送方；
- 零窗口时（接收窗口降为0时），发送方启动一个计时器，每隔一段时间发送一个探测报文，去获得当前最新的窗口值；防止接收方发出的窗口值更新报文滞留在网络中。

### TCP拥塞控制

- 拥塞控制的目的是防止大量的报文进入网络中，把负载控制在网络可承受的范围内；
- 四种方法：（1）慢开始，（2）拥塞避免，（3）快重传，（4）快恢复
  - **拥塞窗口**，发送方让自己的发送窗口等于拥塞窗口；
  - 发送方通过是否发生确认超时来判断是否发生了拥塞，以此来调整拥塞窗口的大小；
  - 慢开始：
    - 发送方逐渐增加拥塞窗口，而不是一下子增大拥塞窗口；
    - 发送方每收到一个确认，就把拥塞窗口增大一些；（这里要注意，**拥塞窗口的的增大速度并不慢（乘法增大）**，因为拥塞窗口增大后，发送能发出更多的报文，能收到更多的确认，拥塞窗口会增加得越来越快）
  - 拥塞避免：
    - 把拥塞窗口的**乘法增大改为加法增大**
    - 慢开始和拥塞避免这两个过程之间有一个**门限值ssthresh**，拥塞窗口过了这个门限值以后切换拥塞控制算法；
    - **发生超时时，把门限值设为当前拥塞窗口的一半，重新开始执行慢开始**。
  - 快重传
    - 快重传是为了避免发送方误以为网络发生了拥塞从而降低传输效率；
    - 接收方在未正确收到一个数据时，应立即重复确认上一个正确收到的数据，发送方一旦收到连续三个重复确认，就马上重传数据，而不会进入超时等待；
  - 快恢复
    - 发送方现在知道了只是**丢失了个别字段**，因此重传的时候不执行慢开始，把发送窗口增大到门限值后**直接进入拥塞避免**算法；

### TCP三次握手、四次挥手

- 三次握手：客户端主动建立连接，服务端被动建立连接
  - 客户端三种状态：closed、syn-sent、establish-listened
  - 服务端四种状态：closed、listened、syn-received、establish-listened
  - 客户端发送**SYN**=1，seq=x;closed-->syn-sent
  - 服务端发送SYN=1，**ACK**=1,ack=y,seq=x+1；listened-->syn-received
  - 客户端发送ACK=1，ack=y+1，seq=x+1；syn-received-->established-listened
  - 服务端接收，syn-received-->established-listened
- 四次挥手：
  - 客户端五种状态：establish-listened, FIN-WAIT1, FIN-WAIT2, TIME-WAIT, closed
            多了两个等待FIN-WAIT2, TIME-WAIT的状态，第一次等服务器把剩下的数据发送完，第二次等一会儿关闭连接
  - 服务端四种状态: establish-listened, close-wait, last-ack,closed
  - 信号种类：**FIN**=1，**ACK**=1
  - 为什么客户端最后要等待2MSL，如果服务器没有收到最后一个ACK报文，服务器会重传"FIN，ACK"报文，等待2MSL是为了能收到这个重传的报文，并重启2MSL计时器

## HTTP

### HTTP和HTTPS的区别

- HTTPS利用SSL/TLS建立全信道，SSL是TLS的前身，SSL（Secure Socket Layer，安全套接字层）,TLS（Transport Layer Security），HTTPS对传输的数据加密，需要CA颁发的SSL证书。
- HTTP的端口是80，HTTPS的端口号是443

### HTTP无状态

- HTTP服务端并不知道这一次和上一次的客户是不是同一个。
- 如何解决这个问题：客户端使用cookie、服务端使用session。

### HTTP请求方法

- HTTP1.0
  - GET
  - POST
  - HEAD：只能获得响应报文的报头
- HTTP1.1
  - PUT
  - DELETE
  - CONNECT
  - OPTIONS
  - TRACE
  - PATCH
- GET和POST的区别
  - GET的参数放在URL里，POST的参数放在request body里（即HTTP报文的数据部分）；因此，在浏览器后退的时候，GET请求得到的页面不会刷新，而POST页面会再次提交请求 ；GET页面可以放在书签里收藏，POST页面就不行；

### HTTP报文结构

- 请求行：请求方法，URL，协议名称和版本号
- 请求头：字段名和值构成的对
  - user-agent
  - content-type（响应）
  - host（请求）
  - content-length（响应）
  - connection：是否保持长连接
  - cookie：跟一个标识（ID）

### HTTP状态码

- 1xx：协议处理的中间状态
- 200：OK（2xx都是成功码）
- 404：资源不存在（4xx都是客户端错误）
- 301：资源永久重定向
- 302：资源暂时重定向
- 502：网关错误（5xx都是服务端错误）
- 504：网关超时

### session和cookie

session在服务端，用于标识一个用户
cookie在客户端，用于记录一些客户的信息

## 网络层

- ARP协议是网络层的协议，但它的工作内容是链路层的。其作用是在局域网内询问MAC地址。
- 动态路由协议  
    动态路由协议是一种去中心化的路由选择协议，路由器可以自己构建自己的路由表，不需要人工干预；但是要消耗一定的网络资源；
  - OSPF、BGP、ISIS、RIP
  - OSPF(Open Shortest Path First开放式最短路径优先）是一个内部网关协议(Interior Gateway Protocol，IGP），用于在单一自治系统（autonomous system,AS）内构建路由；构建邻居关系，建立路由链接，最短路径优先算法建立路由表；
  - RIP(Routing Information Protocol,路由信息协议）是一种内部网关协议（IGP），是一种动态路由选择协议；采用距离向量算法；
  - BGP（边界网关协议），与IGP相对，但也能用在自治系统内部；它是应用层协议，其传输层使用TCP，默认端口号是179

## 其他

- 在浏览器中输入www.baidu.com, 一直到返回出网页内容，请描述中间整个网络过程。以下是答题要点：
  - DNS过程
  - TCP过程（握手，socket，TCP报文）
  - 内核报文封装（IP报文）
  - 路由（IP路由 和 链路层路由ARP）
  - HTTP请求过程
  
- DDos攻击
  - （Distrubuted Denial of Service）分布式拒绝服务攻击，攻击者利用大量分布在不同位置的机器作为"肉鸡"在短时间内向目标服务器提交大量请求，占用目标服务器的大量资源，造成对方服务瘫痪。

- SOCK_RAW、SOCK_STREAM 和 SOCK_DGRAM
  - SOCK_STREAM (TCP)、SOCK_DGRAM (UDP)工作在传输层，SOCK_RAW 工作在网络层。
  - SOCK_RAW 可以处理ICMP、IGMP等网络报文、特殊的IPv4报文、可以通过IP_HDRINCL套接字选项由用户构造IP头。