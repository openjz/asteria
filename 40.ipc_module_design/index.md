# 进程间通信（IPC）模块的设计思路


## 多次IPC模块设计工作带来的思考

不要混淆资源释放（resource release）和停止/断开（stop/disconnect）操作，stop操作是对用户暴露的，resource release是内部操作

资源释放操作通常应当在connect/start失败时或read/write失败时触发，目的是为这些失败操作做收尾，降低用户侧代码的复杂度，如果这些操作交给用户侧代码来做，会导致资源释放操作在用户侧代码分散得到处都是，使用户维护困难，用户通常也并不乐意做这些额外的资源释放操作

例如，如果我们给用户提供了一个start功能，start内部依次建立了多个连接，只要有一个连接失败，就终止start，并返回错误。如果其中一个连接失败，我们不去做任何资源释放操作的话，就意味着前面已成功建立的连接并没有被关闭，用户需要在start返回错误时调用一次stop去断开成功的连接，这对用户来说很奇怪，明明start没有成功，为什么要我去调用一次stop
